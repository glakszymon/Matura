<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System ZarzƒÖdzania Danymi</title>
    <meta name="description" content="Profesjonalny system do zarzƒÖdzania danymi i analizƒÖ wynik√≥w">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/management-styles.css">
    <link rel="stylesheet" href="css/study-session.css">
    <link rel="stylesheet" href="css/task-analysis-forms.css">
    <link rel="stylesheet" href="css/enhanced-analytics.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="system-title">System ZarzƒÖdzania Danymi</h1>
                <p class="system-subtitle">Profesjonalne rozwiƒÖzanie do wprowadzania i analizy danych</p>
            </div>
        </header>

        <!-- Navigation Bar -->
        <nav class="navigation">
            <div class="nav-container">
                <button type="button" id="show-form" class="nav-btn active">
                    <span class="nav-icon">üìù</span>
                    Wprowadzanie Danych
                </button>
                <button type="button" id="show-study" class="nav-btn">
                    <span class="nav-icon">üéØ</span>
                    Sesje Nauki
                </button>
                <button type="button" id="show-analytics" class="nav-btn">
                    <span class="nav-icon">üìä</span>
                    Analiza Wynik√≥w
                </button>
                <button type="button" id="show-enhanced-analytics" class="nav-btn">
                    <span class="nav-icon">üöÄ</span>
                    Zaawansowana Analityka
                </button>
            </div>
        </nav>

        <main class="main-content">
            <!-- Message container for success/error messages -->
            <div id="message-container" class="message-container" style="display: none;"></div>

            <!-- Unified Form Container with Tabs -->
            <div class="unified-form-container" id="main-form-container" style="display: block;">
                <!-- Form Tabs -->
                <div class="form-tabs">
                    <button type="button" class="form-tab active" data-tab="tasks">
                        <span class="tab-icon">üìù</span>
                        Dodawanie Zada≈Ñ
                    </button>
                    <button type="button" class="form-tab" data-tab="subjects">
                        <span class="tab-icon">üìö</span>
                        ZarzƒÖdzanie Przedmiotami
                    </button>
                    <button type="button" class="form-tab" data-tab="categories">
                        <span class="tab-icon">üè∑Ô∏è</span>
                        ZarzƒÖdzanie Kategoriami
                    </button>
                </div>

                <!-- Task Form Tab -->
                <div class="tab-content active" id="tasks-tab">
                    <div class="form-container">
                        <h2>Wprowadzanie Danych</h2>
                        <form id="google-sheets-form" class="google-sheets-form" novalidate>
                        <!-- Task Name field -->
                        <div class="form-group">
                            <label for="task_name" class="form-label">
                                Nazwa zadania <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="task_name" 
                                name="task_name" 
                                class="form-control"
                                maxlength="100"
                                required
                                placeholder="Wprowad≈∫ nazwƒô zadania..."
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Maksymalnie 100 znak√≥w</div>
                        </div>

                        <!-- Description field -->
                        <div class="form-group">
                            <label for="description" class="form-label">
                                Opis <span class="required">*</span>
                            </label>
                            <textarea 
                                id="description" 
                                name="description" 
                                class="form-control form-textarea"
                                maxlength="1000"
                                rows="6"
                                required
                                placeholder="Wprowad≈∫ opis zadania..."
                            ></textarea>
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Maksymalnie 1000 znak√≥w</div>
                        </div>

                        <!-- Categories field (text input for multiple categories) -->
                        <div class="form-group">
                            <label for="categories" class="form-label">
                                Kategorie <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="categories" 
                                name="categories" 
                                class="form-control"
                                maxlength="200"
                                required
                                placeholder="np. Czƒô≈õci mowy, Sk≈Çadnia lub Essays, World War"
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Wprowad≈∫ kategorie oddzielone przecinkami. Przyk≈Çady: "Algebra, R√≥wnania", "Czƒô≈õci mowy, Sk≈Çadnia" (maksymalnie 200 znak√≥w)</div>
                        </div>

                        <!-- Correctly Completed field -->
                        <div class="form-group">
                            <label for="correctly_completed" class="form-label">
                                Wykonano poprawnie <span class="required">*</span>
                            </label>
                            <select 
                                id="correctly_completed" 
                                name="correctly_completed" 
                                class="form-control form-select"
                                required
                            >
                                <option value="">Wybierz opcjƒô...</option>
                                <option value="Yes">Tak</option>
                                <option value="No">Nie</option>
                            </select>
                            <div class="field-error" role="alert"></div>
                        </div>

                        <!-- Location field -->
                        <div class="form-group">
                            <label for="location" class="form-label">
                                Miejsce
                            </label>
                            <input 
                                type="text" 
                                id="location" 
                                name="location" 
                                class="form-control"
                                maxlength="100"
                                placeholder="np. Dom, Biblioteka, Szko≈Ça..."
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Opcjonalne - miejsce wykonania zadania (maksymalnie 100 znak√≥w)</div>
                        </div>

                        <!-- Subject field -->
                        <div class="form-group">
                            <label for="subject" class="form-label">
                                Przedmiot <span class="required">*</span>
                            </label>
                            <select
                                id="subject"
                                name="subject"
                                class="form-control form-select"
                                required
                            >
                                <option value="">Pobieranie przedmiot√≥w z Google Sheets...</option>
                            </select>
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Wybierz przedmiot z listy</div>
                        </div>

                        <!-- Submit button -->
                        <div class="form-actions">
                            <button type="submit" id="submit-button" class="btn btn-primary">
                                Wy≈õlij
                            </button>
                            <button type="button" id="reset-button" class="btn btn-secondary" onclick="document.getElementById('google-sheets-form').reset();">
                                Wyczy≈õƒá
                            </button>
                        </div>
                    </form>
                    </div>
                </div>

                <!-- Subjects Management Tab -->
                <div class="tab-content" id="subjects-tab">
                    <div class="management-section">
                        <div class="management-header">
                            <h2 class="management-title">üìö ZarzƒÖdzanie Przedmiotami</h2>
                            <p class="management-subtitle">Dodawaj, edytuj i usuwaj przedmioty</p>
                        </div>

                        <!-- Add Subject Form -->
                        <div class="management-form-section">
                            <div class="form-card">
                                <h3 class="form-card-title">‚ûï Dodaj Nowy Przedmiot</h3>
                                <form id="add-subject-form" class="management-form">
                                    <div class="form-group">
                                        <label for="subject-name" class="form-label">
                                            Nazwa Przedmiotu <span class="required">*</span>
                                        </label>
                                        <input 
                                            type="text" 
                                            id="subject-name" 
                                            name="subject_name" 
                                            class="form-control"
                                            maxlength="100"
                                            required
                                            placeholder="np. Matematyka, Historia..."
                                        >
                                        <div class="field-error" role="alert"></div>
                                    </div>

                                    <div class="form-group">
                                        <label for="subject-color" class="form-label">
                                            Kolor
                                        </label>
                                        <input 
                                            type="color" 
                                            id="subject-color" 
                                            name="color" 
                                            class="form-control form-color"
                                            value="#667eea"
                                        >
                                        <div class="field-help">Wybierz kolor dla przedmiotu</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="subject-icon" class="form-label">
                                            Ikona
                                        </label>
                                        <input 
                                            type="text" 
                                            id="subject-icon" 
                                            name="icon" 
                                            class="form-control"
                                            maxlength="10"
                                            value="üìö"
                                            placeholder="np. üìö, üî¨, üìê"
                                        >
                                        <div class="field-help">Ikona emoji dla przedmiotu</div>
                                    </div>

                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="btn-icon">üíæ</span>
                                            Dodaj Przedmiot
                                        </button>
                                        <button type="reset" class="btn btn-secondary">
                                            <span class="btn-icon">üîÑ</span>
                                            Wyczy≈õƒá
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Existing Subjects List -->
                        <div class="management-list-section">
                            <div class="list-header">
                                <h3 class="list-title">üìã IstniejƒÖce Przedmioty</h3>
                                <button id="refresh-subjects" class="btn btn-outline">
                                    <span class="btn-icon">üîÑ</span>
                                    Od≈õwie≈º
                                </button>
                            </div>
                            <div class="subjects-list" id="subjects-list">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <span>≈Åadowanie przedmiot√≥w...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Categories Management Tab -->
                <div class="tab-content" id="categories-tab">
                    <div class="management-section">
                        <div class="management-header">
                            <h2 class="management-title">üè∑Ô∏è ZarzƒÖdzanie Kategoriami</h2>
                            <p class="management-subtitle">Dodawaj, edytuj i usuwaj kategorie zada≈Ñ</p>
                        </div>

                        <!-- Add Category Form -->
                        <div class="management-form-section">
                            <div class="form-card">
                                <h3 class="form-card-title">‚ûï Dodaj NowƒÖ Kategoriƒô</h3>
                                <form id="add-category-form" class="management-form">
                                    <div class="form-group">
                                        <label for="category-name" class="form-label">
                                            Nazwa Kategorii <span class="required">*</span>
                                        </label>
                                        <input 
                                            type="text" 
                                            id="category-name" 
                                            name="category_name" 
                                            class="form-control"
                                            maxlength="100"
                                            required
                                            placeholder="np. Algebra, Gramatyka..."
                                        >
                                        <div class="field-error" role="alert"></div>
                                    </div>

                                    <div class="form-group">
                                        <label for="category-subject" class="form-label">
                                            Przedmiot <span class="required">*</span>
                                        </label>
                                        <select 
                                            id="category-subject" 
                                            name="subject_name" 
                                            class="form-control form-select"
                                            required
                                        >
                                            <option value="">Pobieranie przedmiot√≥w...</option>
                                        </select>
                                        <div class="field-error" role="alert"></div>
                                        <div class="field-help">Wybierz przedmiot dla tej kategorii</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="category-difficulty" class="form-label">
                                            Poziom trudno≈õci <span class="required">*</span>
                                        </label>
                                        <select 
                                            id="category-difficulty" 
                                            name="difficulty" 
                                            class="form-control form-select"
                                            required
                                        >
                                            <option value="">Wybierz poziom...</option>
                                            <option value="≈Åatwy">≈Åatwy</option>
                                            <option value="≈öredni">≈öredni</option>
                                            <option value="Trudny">Trudny</option>
                                        </select>
                                        <div class="field-error" role="alert"></div>
                                        <div class="field-help">Okre≈õl poziom trudno≈õci kategorii</div>
                                    </div>

                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="btn-icon">üíæ</span>
                                            Dodaj Kategoriƒô
                                        </button>
                                        <button type="reset" class="btn btn-secondary">
                                            <span class="btn-icon">üîÑ</span>
                                            Wyczy≈õƒá
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Existing Categories List -->
                        <div class="management-list-section">
                            <div class="list-header">
                                <h3 class="list-title">üìã IstniejƒÖce Kategorie</h3>
                                <button id="refresh-categories" class="btn btn-outline">
                                    <span class="btn-icon">üîÑ</span>
                                    Od≈õwie≈º
                                </button>
                            </div>
                            <div class="categories-list" id="categories-list">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <span>≈Åadowanie kategorii...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Container -->
            <div class="analytics-dashboard" id="analytics-container" style="display: none;">
                <!-- Analytics Header -->
                <div class="analytics-header">
                    <div class="analytics-title-section">
                        <h1 class="analytics-main-title">üìä Analityka Wynik√≥w</h1>
                        <p class="analytics-subtitle">Wybierz przedmiot aby zobaczyƒá szczeg√≥≈Çowe statystyki i postƒôpy</p>
                    </div>
                </div>
                
                <!-- Main Analytics Layout -->
                <div class="analytics-main-layout">
                    <!-- Left Panel: Large Subject Selection -->
                    <div class="analytics-left-panel">
                        <div class="subject-selection-panel" id="subject-selection-section" style="display: none;">
                            <h2 class="panel-title">üéØ Twoje Przedmioty</h2>
                            <div class="large-subject-buttons" id="subject-buttons" style="display: grid; grid-template-columns: auto auto;">
                                <!-- Large enhanced subject buttons will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- No Data State -->
                        <div class="no-subjects-panel" id="no-subjects-panel" style="display: none;">
                            <div class="no-data-illustration">üìà</div>
                            <h3 class="no-data-title">Brak Danych do Analizy</h3>
                            <p class="no-data-description">Dodaj zadania do Google Sheets, aby zobaczyƒá analitykƒô wynik√≥w wed≈Çug przedmiot√≥w.</p>
                        </div>
                    </div>
                    
                    <!-- Right Panel: Detailed Analytics -->
                    <div class="analytics-right-panel">
                        <div class="analytics-content" id="analytics-content">
                            <div class="welcome-state" id="welcome-state">
                                <div class="welcome-illustration">üëà</div>
                                <h3 class="welcome-title">Wybierz Przedmiot</h3>
                                <p class="welcome-description">Kliknij na przedmiot po lewej stronie, aby zobaczyƒá szczeg√≥≈ÇowƒÖ analizƒô wynik√≥w, kategorii i postƒôp√≥w w nauce.</p>
                                <div class="welcome-features">
                                    <div class="feature-item">
                                        <span class="feature-icon">üìä</span>
                                        <span class="feature-text">Szczeg√≥≈Çowe statystyki</span>
                                    </div>
                                    <div class="feature-item">
                                        <span class="feature-icon">üìà</span>
                                        <span class="feature-text">Analizy postƒôp√≥w</span>
                                    </div>
                                    <div class="feature-item">
                                        <span class="feature-icon">üéØ</span>
                                        <span class="feature-text">S≈Çabe punkty do poprawy</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="loading-state" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">Analizowanie wynik√≥w...</div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>


            <!-- Study Session Modal -->
            <div class="modal-overlay" id="study-session-modal" style="display: none;">
                <div class="modal-content study-session-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üéØ Sesja Nauki w Toku</h3>
                        <div class="session-timer" id="session-timer">00:00</div>
                    </div>
                    <div class="modal-body">
                        <!-- Task Counters -->
                        <div class="task-counters">
                            <div class="counter-item">
                                <div class="counter-value" id="total-tasks-counter">0</div>
                                <div class="counter-label">Ca≈Çkowite Zadania</div>
                            </div>
                            <div class="counter-item correct">
                                <div class="counter-value" id="correct-tasks-counter">0</div>
                                <div class="counter-label">Poprawne</div>
                            </div>
                            <div class="counter-item incorrect">
                                <div class="counter-value" id="incorrect-tasks-counter">0</div>
                                <div class="counter-label">B≈Çƒôdne</div>
                            </div>
                        </div>

                        <!-- Task Action Buttons -->
                        <div class="task-actions">
                            <button type="button" id="correct-task-btn" class="btn btn-success btn-large">
                                <span class="btn-icon">‚úÖ</span>
                                Zadanie Poprawne
                            </button>
                            <button type="button" id="incorrect-task-btn" class="btn btn-error btn-large">
                                <span class="btn-icon">‚ùå</span>
                                Zadanie B≈Çƒôdne
                            </button>
                        </div>

                        <!-- Current Task Info -->
                        <div class="current-task-info">
                            <div class="task-info-item">
                                <span class="task-info-label">Aktualne zadanie:</span>
                                <span class="task-info-value" id="current-task-number">1</span>
                            </div>
                            <div class="task-info-item">
                                <span class="task-info-label">Czas zadania:</span>
                                <span class="task-info-value" id="current-task-time">00:00</span>
                            </div>
                        </div>

                        <!-- Session Controls -->
                        <div class="session-controls">
                            <button type="button" id="finish-session-btn" class="btn btn-primary btn-large">
                                <span class="btn-icon">üèÅ</span>
                                Zako≈Ñcz Sesjƒô
                            </button>
                            <button type="button" id="pause-session-btn" class="btn btn-secondary">
                                <span class="btn-icon">‚è∏Ô∏è</span>
                                Pauza
                            </button>
                        </div>
                    </div>

                    <!-- Celebration Overlay -->
                    <div class="celebration-overlay" id="celebration-overlay" style="display: none;">
                        <div class="celebration-content">
                            <div class="celebration-icon" id="celebration-icon">üéâ</div>
                            <div class="celebration-text" id="celebration-text">Dobra robota!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Sessions Dashboard Container -->
            <div class="study-sessions-dashboard" id="study-container" style="display: none; visibility: hidden;">
                <!-- Enhanced Study Sessions Content -->
                <div style="background: white; padding: 30px; margin: 20px; border-radius: 12px; border: 2px solid #10b981;">
                    <h1 style="color: #10b981; font-size: 2.5rem; text-align: center; margin: 20px 0;">üéØ Study Sessions</h1>
                    <p style="font-size: 1.5rem; text-align: center; color: #333;">If you can see this, the study view is working!</p>
                    
                    <div style="background: #667eea; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
                        <button id="start-study-button" style="background: #10b981; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; cursor: pointer; margin: 10px;">
                            üèÅ Start Study Session
                        </button>
                        <button id="view-history-button" style="background: #6b7280; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; cursor: pointer; margin: 10px;">
                            üìÖ View History
                        </button>
                    </div>

                    <!-- Study Dashboard Stats -->
                    <div class="session-stats-panel" style="margin-top: 30px;">
                        <h2 class="panel-title">üìä Statystyki Dzisiaj</h2>
                        <div class="quick-stats-grid">
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-sessions">0</div>
                                <div class="stat-label">Sesje Dzisiaj</div>
                            </div>
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-tasks">0</div>
                                <div class="stat-label">Zadania Dzisiaj</div>
                            </div>
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-accuracy">0%</div>
                                <div class="stat-label">Dok≈Çadno≈õƒá</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sessions List -->
                    <div class="recent-sessions-panel" style="margin-top: 30px;">
                        <h2 class="panel-title">üìÖ Ostatnie Sesje</h2>
                        <div id="recent-sessions-list" class="recent-sessions-list">
                            <div class="no-sessions-placeholder">
                                <div class="placeholder-icon">üìà</div>
                                <p>Brak ostatnich sesji nauki</p>
                                <p class="placeholder-description">Rozpocznij pierwszƒÖ sesjƒô, aby zobaczyƒá historiƒô</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Analytics Dashboard Container -->
            <div class="enhanced-analytics-dashboard" id="enhanced-analytics-container" style="display: none;">
                <!-- Enhanced Analytics Header -->
                <div class="enhanced-analytics-header">
                    <h1 class="enhanced-analytics-title">üìä Zaawansowana Analityka Nauki</h1>
                    <p class="enhanced-analytics-subtitle">Kompleksowa analiza postƒôp√≥w, systematyczno≈õci i wydajno≈õci nauki</p>
                </div>
                
                <!-- Analytics Tabs -->
                <div class="analytics-tabs">
                    <button class="analytics-tab active" data-tab="overview">
                        <span class="analytics-tab-icon">üìà</span>
                        PrzeglƒÖd
                    </button>
                    <button class="analytics-tab" data-tab="performance">
                        <span class="analytics-tab-icon">üéØ</span>
                        Skuteczno≈õƒá w czasie
                    </button>
                    <button class="analytics-tab" data-tab="consistency">
                        <span class="analytics-tab-icon">üî•</span>
                        Systematyczno≈õƒá
                    </button>
                    <button class="analytics-tab" data-tab="time-analysis">
                        <span class="analytics-tab-icon">üïê</span>
                        Analiza czasu
                    </button>
                    <button class="analytics-tab" data-tab="subjects">
                        <span class="analytics-tab-icon">üìö</span>
                        Przedmioty
                    </button>
                    <button class="analytics-tab" data-tab="locations">
                        <span class="analytics-tab-icon">üìç</span>
                        Lokalizacje
                    </button>
                    <button class="analytics-tab" data-tab="progress">
                        <span class="analytics-tab-icon">üèÜ</span>
                        Postƒôpy
                    </button>
                </div>

                <!-- Loading State -->
                <div id="enhanced-analytics-loading" class="loading-container" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">≈Åadowanie analityki...</div>
                </div>

                <!-- Overview Tab -->
                <div class="analytics-tab-content active" id="overview-tab">
                    <!-- Key Insights -->
                    <div class="analytics-insights" id="key-insights">
                        <!-- Insights will be populated by JavaScript -->
                    </div>
                    
                    <!-- Enhanced Metrics Grid -->
                    <div class="enhanced-metrics-grid" id="overview-metrics">
                        <!-- Metrics cards will be populated by JavaScript -->
                    </div>
                    
                    <!-- Quick Charts Section -->
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üìä PrzeglƒÖd ostatnich 30 dni
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="overview-performance-chart">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Performance Over Time Tab -->
                <div class="analytics-tab-content" id="performance-tab">
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üìà Skuteczno≈õƒá w czasie
                            </h2>
                            <div class="enhanced-chart-controls">
                                <button class="chart-control-btn active" data-period="WEEK">Tydzie≈Ñ</button>
                                <button class="chart-control-btn" data-period="MONTH">MiesiƒÖc</button>
                                <button class="chart-control-btn" data-period="QUARTER">3 miesiƒÖce</button>
                                <button class="chart-control-btn" data-period="ALL">Wszystko</button>
                            </div>
                        </div>
                        <div class="enhanced-chart-container" id="performance-trend-chart">
                            <!-- Performance trend chart -->
                        </div>
                    </div>

                    <!-- Performance Summary Cards -->
                    <div class="enhanced-metrics-grid" id="performance-metrics">
                        <!-- Performance metrics cards -->
                    </div>
                </div>

                <!-- Study Consistency Tab -->
                <div class="analytics-tab-content" id="consistency-tab">
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üî• Kalendarz aktywno≈õci
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="consistency-heatmap">
                            <!-- Consistency heatmap -->
                        </div>
                    </div>

                    <!-- Consistency Metrics -->
                    <div class="enhanced-metrics-grid" id="consistency-metrics">
                        <!-- Consistency metrics cards -->
                    </div>
                </div>

                <!-- Time of Day Analysis Tab -->
                <div class="analytics-tab-content" id="time-analysis-tab">
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üïê Skuteczno≈õƒá wed≈Çug pory dnia
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="time-of-day-chart">
                            <!-- Time of day chart -->
                        </div>
                    </div>

                    <!-- Time Period Cards -->
                    <div class="time-period-grid" id="time-period-cards">
                        <!-- Time period cards -->
                    </div>

                    <!-- Recommendations -->
                    <div class="analytics-insights" id="time-recommendations">
                        <!-- Time-based recommendations -->
                    </div>
                </div>

                <!-- Subjects Analysis Tab -->
                <div class="analytics-tab-content" id="subjects-tab">
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üéØ Por√≥wnanie przedmiot√≥w
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="subjects-radar-chart">
                            <!-- Subjects radar chart -->
                        </div>
                    </div>

                    <!-- Subject Analysis Cards -->
                    <div class="enhanced-metrics-grid" id="subjects-metrics">
                        <!-- Subject metrics cards -->
                    </div>
                </div>

                <!-- Locations Analysis Tab -->
                <div class="analytics-tab-content" id="locations-tab">
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üìç Skuteczno≈õƒá wed≈Çug lokalizacji
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="location-impact-chart">
                            <!-- Location impact chart -->
                        </div>
                    </div>

                    <!-- Location Comparison -->
                    <div class="location-comparison" id="location-cards">
                        <!-- Location cards -->
                    </div>
                </div>

                <!-- Progress Tracking Tab -->
                <div class="analytics-tab-content" id="progress-tab">
                    <!-- Progress Indicators -->
                    <div class="progress-section" id="progress-indicators">
                        <!-- Progress cards -->
                    </div>

                    <!-- Achievements -->
                    <div class="analytics-insights" id="achievements-section">
                        <!-- Achievements -->
                    </div>

                    <!-- Progress Charts -->
                    <div class="enhanced-chart-section">
                        <div class="enhanced-chart-header">
                            <h2 class="enhanced-chart-title">
                                üìä Postƒôp w czasie
                            </h2>
                        </div>
                        <div class="enhanced-chart-container" id="progress-over-time-chart">
                            <!-- Progress over time chart -->
                        </div>
                    </div>
                </div>

                <!-- Error State -->
                <div id="enhanced-analytics-error" class="error-container" style="display: none;">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-title">B≈ÇƒÖd ≈Çadowania analityki</div>
                    <div class="error-message">Sprawd≈∫ po≈ÇƒÖczenie internetowe i spr√≥buj ponownie.</div>
                    <button onclick="window.enhancedAnalyticsApp?.loadAnalyticsData()" class="error-retry-btn">Spr√≥buj ponownie</button>
                </div>
            </div>

            <!-- Study Session Modal -->
            <div class="modal-overlay" id="study-analysis-modal" style="display: none;">
                <div class="modal-content study-analysis-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üìà Analiza Sesji Nauki</h3>
                        <div class="session-summary" id="session-summary">
                            Zadania: <span id="summary-total">0</span> | 
                            Poprawne: <span id="summary-correct">0</span> | 
                            B≈Çƒôdne: <span id="summary-incorrect">0</span>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="analysis-form-container" id="analysis-form-container">
                            <!-- Task analysis forms will be dynamically inserted here -->
                        </div>
                        <div class="analysis-actions">
                            <button type="button" id="submit-analysis-btn" class="btn btn-primary btn-large">
                                <span class="btn-icon">üíæ</span>
                                Zapisz Wszystkie Dane
                            </button>
                            <button type="button" id="cancel-analysis-btn" class="btn btn-secondary">
                                <span class="btn-icon">‚ùå</span>
                                Anuluj
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Session History Modal -->
            <div class="modal-overlay" id="session-history-modal" style="display: none;">
                <div class="modal-content session-history-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üìÖ Historia Sesji Nauki</h3>
                        <button class="modal-close" id="close-history-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- History Filters -->
                        <div class="history-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label for="history-date-filter" class="filter-label">Okres:</label>
                                    <select id="history-date-filter" class="form-control filter-select">
                                        <option value="all">Wszystkie sesje</option>
                                        <option value="today">Dzisiaj</option>
                                        <option value="week">Ostatni tydzie≈Ñ</option>
                                        <option value="month">Ostatni miesiƒÖc</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="history-sort-filter" class="filter-label">Sortowanie:</label>
                                    <select id="history-sort-filter" class="form-control filter-select">
                                        <option value="newest">Najnowsze pierwsze</option>
                                        <option value="oldest">Najstarsze pierwsze</option>
                                        <option value="duration">Czas trwania</option>
                                        <option value="tasks">Liczba zada≈Ñ</option>
                                        <option value="accuracy">Dok≈Çadno≈õƒá</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-stats" id="history-stats">
                                <span class="stats-item">≈ÅƒÖcznie sesji: <strong id="total-sessions-count">0</strong></span>
                                <span class="stats-item">≈ÅƒÖczny czas: <strong id="total-study-time">0 min</strong></span>
                                <span class="stats-item">≈örednia dok≈Çadno≈õƒá: <strong id="average-accuracy">0%</strong></span>
                            </div>
                        </div>

                        <!-- Session History List -->
                        <div class="session-history-container" id="session-history-container">
                            <div class="loading-state" id="history-loading" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">≈Åadowanie historii sesji...</div>
                            </div>
                            
                            <div class="no-history-state" id="no-history-state" style="display: none;">
                                <div class="no-data-illustration">üìö</div>
                                <h4>Brak Historii Sesji</h4>
                                <p>Nie masz jeszcze ≈ºadnych zako≈Ñczonych sesji nauki.</p>
                                <p class="help-text">Rozpocznij pierwszƒÖ sesjƒô, aby zobaczyƒá tutaj historiƒô.</p>
                            </div>
                            
                            <div class="sessions-list" id="sessions-history-list">
                                <!-- Session history items will be inserted here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="refresh-history-btn" class="btn btn-outline">
                            <span class="btn-icon">üîÑ</span>
                            Od≈õwie≈º
                        </button>
                        <button type="button" id="close-history-btn" class="btn btn-secondary">
                            <span class="btn-icon">‚ùå</span>
                            Zamknij
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Modal -->
            <div class="modal-overlay" id="edit-modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="edit-modal-title">‚úèÔ∏è Edytuj Element</h3>
                        <button class="modal-close" id="close-edit-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-form">
                            <input type="hidden" id="edit-item-id" name="id">
                            <input type="hidden" id="edit-form-type" name="formType">
                            
                            <!-- Basic name field - will be used for both subjects and categories -->
                            <div class="form-group">
                                <label for="edit-name" class="form-label">
                                    Nazwa <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-name" 
                                    name="name" 
                                    class="form-control"
                                    maxlength="100"
                                    required
                                >
                                <div class="field-error" role="alert"></div>
                            </div>

                            <!-- Subject-specific fields -->
                            <div class="form-group subject-only" id="edit-color-group" style="display: none;">
                                <label for="edit-color" class="form-label">
                                    Kolor
                                </label>
                                <input 
                                    type="color" 
                                    id="edit-color" 
                                    name="color" 
                                    class="form-control form-color"
                                    value="#667eea"
                                >
                                <div class="field-help">Wybierz kolor dla przedmiotu</div>
                            </div>

                            <div class="form-group subject-only" id="edit-icon-group" style="display: none;">
                                <label for="edit-icon" class="form-label">
                                    Ikona
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-icon" 
                                    name="icon" 
                                    class="form-control"
                                    maxlength="10"
                                    placeholder="np. üìö, üî¨, üìê"
                                >
                                <div class="field-help">Ikona emoji dla przedmiotu</div>
                            </div>

                            <!-- Category-specific fields -->
                            <div class="form-group category-only" id="edit-subject-group" style="display: none;">
                                <label for="edit-subject" class="form-label">
                                    Przedmiot <span class="required">*</span>
                                </label>
                                <select 
                                    id="edit-subject" 
                                    name="subject_name" 
                                    class="form-control form-select"
                                    required
                                >
                                    <option value="">≈Åadowanie przedmiot√≥w...</option>
                                </select>
                                <div class="field-error" role="alert"></div>
                            </div>

                            <div class="form-group category-only" id="edit-difficulty-group" style="display: none;">
                                <label for="edit-difficulty" class="form-label">
                                    Poziom trudno≈õci <span class="required">*</span>
                                </label>
                                <select 
                                    id="edit-difficulty" 
                                    name="difficulty" 
                                    class="form-control form-select"
                                    required
                                >
                                    <option value="">Wybierz poziom...</option>
                                    <option value="≈Åatwy">≈Åatwy</option>
                                    <option value="≈öredni">≈öredni</option>
                                    <option value="Trudny">Trudny</option>
                                </select>
                                <div class="field-error" role="alert"></div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-icon">üíæ</span>
                                    Zapisz Zmiany
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancel-edit">
                                    <span class="btn-icon">‚ùå</span>
                                    Anuluj
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </main>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2024 System ZarzƒÖdzania Danymi. Wszystkie dane sƒÖ synchronizowane z Google Sheets.</p>
            </div>
        </footer>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p id="loading-text">Przetwarzanie...</p>
    </div>

    <!-- Chart.js for enhanced analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- JavaScript files -->
    <script src="js/config.js"></script>
    <script src="js/googleSheetsDebugger.js"></script>
    <script src="js/loadingManager.js"></script>
    <script src="js/googleSheetsAPI-v2.js"></script>
    <!-- DISABLED: StudyTrackingManager to prevent duplicate sessions -->
    <!-- <script src="js/studyTrackingManager.js"></script> -->
    <script src="js/analyticsManager.js"></script>
    <script src="js/enhancedAnalytics.js"></script>
    <script src="js/chartsManager.js"></script>
    <script src="js/managementForms.js"></script>
    <script src="js/app-simplified.js"></script>
    
    <!-- App initialization -->
    <script>
        // Global coordination object (StudyTrackingManager disabled - using SimplifiedFormApp only)
        window.systemCoordination = {
            studySessionActive: false,  // Not used since StudyTrackingManager is disabled
            isSubmittingStudyData: false  // Not used since StudyTrackingManager is disabled
        };
        
        // System ZarzƒÖdzania Danymi - Ready for operation
        console.log('üìä System ZarzƒÖdzania Danymi - Initialized');
        console.log('üí° Use enableGSDebug() to track Google Sheets data retrieval');
        console.log('üéÜ StudyTrackingManager disabled - using SimplifiedFormApp only');
        
        // Simple fix to ensure study sessions work
        console.log('üìö Study Sessions ready');
        
        // Enhanced navigation system for all containers
        function setupNavigation() {
            // Get all navigation buttons
            const formBtn = document.getElementById('show-form');
            const studyBtn = document.getElementById('show-study');
            const analyticsBtn = document.getElementById('show-analytics');
            const enhancedAnalyticsBtn = document.getElementById('show-enhanced-analytics');
            
            // Get all containers
            const containers = {
                form: document.getElementById('main-form-container'),
                study: document.getElementById('study-container'),
                analytics: document.getElementById('analytics-container'),
                enhancedAnalytics: document.getElementById('enhanced-analytics-container')
            };
            
            // Function to hide all containers
            function hideAllContainers() {
                Object.values(containers).forEach(container => {
                    if (container) {
                        container.style.display = 'none';
                        container.style.visibility = 'hidden';
                        container.style.opacity = '0';
                    }
                });
            }
            
            // Function to show specific container
            function showContainer(containerKey) {
                hideAllContainers();
                const container = containers[containerKey];
                if (container) {
                    container.style.display = 'block';
                    container.style.visibility = 'visible';
                    container.style.opacity = '1';
                    console.log(`‚úÖ ${containerKey} container shown`);
                }
                
                // Update active nav button
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            // Set up navigation event listeners
            if (formBtn) {
                formBtn.addEventListener('click', () => {
                    showContainer('form');
                    formBtn.classList.add('active');
                });
            }
            
            if (studyBtn) {
                studyBtn.addEventListener('click', () => {
                    showContainer('study');
                    studyBtn.classList.add('active');
                });
            }
            
            if (analyticsBtn) {
                analyticsBtn.addEventListener('click', () => {
                    showContainer('analytics');
                    analyticsBtn.classList.add('active');
                });
            }
            
            if (enhancedAnalyticsBtn) {
                enhancedAnalyticsBtn.addEventListener('click', () => {
                    showContainer('enhancedAnalytics');
                    enhancedAnalyticsBtn.classList.add('active');
                    
                    // Initialize enhanced analytics if not already done
                    if (!window.enhancedAnalyticsApp) {
                        window.initializeEnhancedAnalytics();
                    }
                });
            }
        }
        
        // Enhanced Analytics Initialization
        window.initializeEnhancedAnalytics = function() {
            if (window.enhancedAnalyticsApp) {
                console.log('Enhanced Analytics already initialized');
                return;
            }
            
            console.log('üöÄ Initializing Enhanced Analytics App...');
            
            try {
                // Create Enhanced Analytics App
                window.enhancedAnalyticsApp = new EnhancedAnalyticsApp();
                console.log('‚úÖ Enhanced Analytics App initialized successfully');
            } catch (error) {
                console.error('‚ùå Error initializing Enhanced Analytics App:', error);
            }
        };
        
        // Enhanced Analytics Application Class
        class EnhancedAnalyticsApp {
            constructor() {
                this.config = CONFIG;
                this.googleSheetsAPI = null;
                this.enhancedAnalytics = null;
                this.chartsManager = null;
                this.currentTab = 'overview';
                this.analyticsData = null;
                
                this.init();
            }
            
            async init() {
                console.log('üöÄ Initializing Enhanced Analytics App...');
                
                try {
                    // Initialize Google Sheets API
                    this.googleSheetsAPI = new GoogleSheetsAPIv2(this.config);
                    
                    // Initialize Enhanced Analytics
                    this.enhancedAnalytics = new EnhancedAnalytics(this.config, this.googleSheetsAPI);
                    
                    // Initialize Charts Manager
                    this.chartsManager = new ChartsManager(this.enhancedAnalytics);
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Load analytics data
                    await this.loadAnalyticsData();
                    
                    console.log('‚úÖ Enhanced Analytics App initialized');
                } catch (error) {
                    console.error('‚ùå Error initializing Enhanced Analytics App:', error);
                    this.showError('B≈ÇƒÖd inicjalizacji aplikacji analityki');
                }
            }
            
            setupEventListeners() {
                // Tab switching
                const tabButtons = document.querySelectorAll('.analytics-tab');
                tabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tabName = e.target.getAttribute('data-tab');
                        if (tabName) {
                            this.switchTab(tabName);
                        }
                    });
                });
                
                // Chart control buttons
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('chart-control-btn')) {
                        this.handleChartControl(e.target);
                    }
                });
            }
            
            async loadAnalyticsData() {
                this.showLoading(true);
                
                try {
                    const result = await this.enhancedAnalytics.loadAnalyticsData();
                    
                    if (result.success) {
                        this.analyticsData = result.data;
                        this.renderAllTabs();
                        this.showLoading(false);
                    } else {
                        throw new Error(result.error || 'Failed to load analytics data');
                    }
                } catch (error) {
                    console.error('‚ùå Error loading analytics data:', error);
                    this.showError('B≈ÇƒÖd ≈Çadowania danych analityki');
                    this.showLoading(false);
                }
            }
            
            switchTab(tabName) {
                // Update active tab button
                document.querySelectorAll('.analytics-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
                });
                
                // Update active tab content
                document.querySelectorAll('.analytics-tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === tabName + '-tab');
                });
                
                this.currentTab = tabName;
                
                // Load tab-specific content if needed
                if (this.analyticsData) {
                    this.renderTabContent(tabName);
                }
            }
            
            renderAllTabs() {
                if (!this.analyticsData) return;
                
                this.renderOverviewTab();
                this.renderPerformanceTab();
                this.renderConsistencyTab();
                this.renderTimeAnalysisTab();
                this.renderSubjectsTab();
                this.renderLocationsTab();
                this.renderProgressTab();
            }
            
            renderTabContent(tabName) {
                if (!this.analyticsData) return;
                
                switch(tabName) {
                    case 'overview':
                        this.renderOverviewTab();
                        break;
                    case 'performance':
                        this.renderPerformanceTab();
                        break;
                    case 'consistency':
                        this.renderConsistencyTab();
                        break;
                    case 'time-analysis':
                        this.renderTimeAnalysisTab();
                        break;
                    case 'subjects':
                        this.renderSubjectsTab();
                        break;
                    case 'locations':
                        this.renderLocationsTab();
                        break;
                    case 'progress':
                        this.renderProgressTab();
                        break;
                }
            }
            
            renderOverviewTab() {
                const report = this.enhancedAnalytics.generateReport();
                
                // Render key insights
                this.renderInsights(report.insights, 'key-insights');
                
                // Render overview metrics
                this.renderOverviewMetrics();
                
                // Render overview chart with actual data
                if (this.analyticsData.performanceOverTime) {
                    this.chartsManager.createPerformanceOverTimeChart(
                        this.analyticsData.performanceOverTime, 
                        'overview-performance-chart'
                    );
                }
            }
            
            renderPerformanceTab() {
                if (this.analyticsData.performanceOverTime) {
                    this.chartsManager.createPerformanceOverTimeChart(
                        this.analyticsData.performanceOverTime, 
                        'performance-trend-chart'
                    );
                }
                this.renderPerformanceMetrics();
            }
            
            renderConsistencyTab() {
                if (this.analyticsData.studyConsistency) {
                    this.chartsManager.createConsistencyHeatmapChart(
                        this.analyticsData.studyConsistency, 
                        'consistency-heatmap'
                    );
                }
                this.renderConsistencyMetrics();
            }
            
            renderTimeAnalysisTab() {
                if (this.analyticsData.timeOfDayAnalysis) {
                    this.chartsManager.createTimeOfDayChart(
                        this.analyticsData.timeOfDayAnalysis, 
                        'time-of-day-chart'
                    );
                }
                this.renderTimePeriodCards();
                this.renderTimeRecommendations();
            }
            
            renderSubjectsTab() {
                if (this.analyticsData.subjectAnalysis) {
                    this.chartsManager.createSubjectRadarChart(
                        this.analyticsData.subjectAnalysis, 
                        'subjects-radar-chart'
                    );
                }
                this.renderSubjectMetrics();
            }
            
            renderLocationsTab() {
                if (this.analyticsData.locationAnalysis) {
                    this.chartsManager.createLocationImpactChart(
                        this.analyticsData.locationAnalysis, 
                        'location-impact-chart'
                    );
                }
                this.renderLocationCards();
            }
            
            renderProgressTab() {
                this.renderProgressIndicators();
                this.renderAchievements();
                if (this.analyticsData.progressTracking) {
                    this.chartsManager.createProgressOverTimeChart(
                        this.analyticsData.progressTracking, 
                        'progress-over-time-chart'
                    );
                }
            }
            
            renderPlaceholderChart(containerId, title) {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="chart-placeholder">
                            <div class="chart-placeholder-icon">üìä</div>
                            <div class="chart-placeholder-text">${title} - wykres bƒôdzie dostƒôpny wkr√≥tce</div>
                        </div>
                    `;
                }
            }
            
            // Helper methods for rendering specific components
            renderInsights(insights, containerId) {
                const container = document.getElementById(containerId);
                if (!container || !insights) return;
                
                container.innerHTML = insights.map(insight => `
                    <div class="insight-card ${insight.type}">
                        <div class="insight-header">
                            <span class="insight-emoji">${insight.emoji}</span>
                            <h3 class="insight-title">${insight.title}</h3>
                        </div>
                        <p class="insight-message">${insight.message}</p>
                    </div>
                `).join('');
            }
            
            renderOverviewMetrics() {
                const container = document.getElementById('overview-metrics');
                if (!container) return;
                
                const report = this.enhancedAnalytics.generateReport();
                const summary = report.summary;
                
                container.innerHTML = `
                    <div class="enhanced-metric-card" style="--metric-color: #10b981;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìù</div>
                            <span class="metric-card-title">Wszystkich zada≈Ñ</span>
                        </div>
                        <div class="metric-card-value">${summary.totalTasks}</div>
                        <div class="metric-card-subtitle">zadania wykonane</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #3b82f6;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üéØ</div>
                            <span class="metric-card-title">Skuteczno≈õƒá</span>
                        </div>
                        <div class="metric-card-value">${summary.overallAccuracy}%</div>
                        <div class="metric-card-subtitle">≈õrednia dok≈Çadno≈õƒá</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #f59e0b;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìÖ</div>
                            <span class="metric-card-title">Dni nauki</span>
                        </div>
                        <div class="metric-card-value">${summary.studyDays}</div>
                        <div class="metric-card-subtitle">unikalnych dni</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #ef4444;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üî•</div>
                            <span class="metric-card-title">Aktualna passa</span>
                        </div>
                        <div class="metric-card-value">${summary.currentStreak}</div>
                        <div class="metric-card-subtitle">dni z rzƒôdu</div>
                    </div>
                `;
            }
            
            renderPerformanceMetrics() {
                const container = document.getElementById('performance-metrics');
                if (!container) return;
                
                const perfData = this.analyticsData.performanceOverTime;
                
                container.innerHTML = `
                    <div class="enhanced-metric-card" style="--metric-color: #10b981;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìà</div>
                            <span class="metric-card-title">≈örednia skuteczno≈õƒá</span>
                        </div>
                        <div class="metric-card-value">${perfData.averageAccuracy || 0}%</div>
                        <div class="metric-card-subtitle">w analizowanym okresie</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #3b82f6;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìä</div>
                            <span class="metric-card-title">Najlepszy dzie≈Ñ</span>
                        </div>
                        <div class="metric-card-value">${perfData.bestDay ? perfData.bestDay.accuracy : 0}%</div>
                        <div class="metric-card-subtitle">${perfData.bestDay ? new Date(perfData.bestDay.date).toLocaleDateString('pl-PL') : 'Brak danych'}</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #f59e0b;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìÖ</div>
                            <span class="metric-card-title">Dni nauki</span>
                        </div>
                        <div class="metric-card-value">${perfData.totalDays || 0}</div>
                        <div class="metric-card-subtitle">aktywnych dni</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #ef4444;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üéØ</div>
                            <span class="metric-card-title">Stabilno≈õƒá</span>
                        </div>
                        <div class="metric-card-value">${perfData.consistency || 0}%</div>
                        <div class="metric-card-subtitle">sta≈Ço≈õci wynik√≥w</div>
                    </div>
                `;
            }
            
            renderConsistencyMetrics() {
                const container = document.getElementById('consistency-metrics');
                if (!container) return;
                
                const consData = this.analyticsData.studyConsistency;
                
                container.innerHTML = `
                    <div class="enhanced-metric-card" style="--metric-color: #ef4444;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üî•</div>
                            <span class="metric-card-title">Aktualna passa</span>
                        </div>
                        <div class="metric-card-value">${consData.currentStreak || 0}</div>
                        <div class="metric-card-subtitle">dni z rzƒôdu</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #10b981;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìä</div>
                            <span class="metric-card-title">Systematyczno≈õƒá</span>
                        </div>
                        <div class="metric-card-value">${Math.round((consData.consistencyScore || 0) * 100)}%</div>
                        <div class="metric-card-subtitle">regularno≈õci nauki</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #3b82f6;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üìÖ</div>
                            <span class="metric-card-title">Aktywne dni</span>
                        </div>
                        <div class="metric-card-value">${consData.totalActiveDays || 0}</div>
                        <div class="metric-card-subtitle">ostatnie 90 dni</div>
                    </div>
                    
                    <div class="enhanced-metric-card" style="--metric-color: #f59e0b;">
                        <div class="metric-card-header">
                            <div class="metric-card-icon">üèÜ</div>
                            <span class="metric-card-title">Najd≈Çu≈ºsza passa</span>
                        </div>
                        <div class="metric-card-value">${consData.longestStreak || 0}</div>
                        <div class="metric-card-subtitle">rekordowa passa</div>
                    </div>
                `;
            }
            
            renderTimePeriodCards() {
                const container = document.getElementById('time-period-cards');
                if (!container || !this.analyticsData.timeOfDayAnalysis) return;
                
                const timePeriods = this.analyticsData.timeOfDayAnalysis.timePeriods || {};
                const periods = Object.keys(timePeriods).filter(period => timePeriods[period].total > 0);
                
                if (periods.length === 0) {
                    container.innerHTML = '<div class="placeholder-text">Brak danych o porach dnia</div>';
                    return;
                }
                
                const periodsHTML = periods.map(period => {
                    const data = timePeriods[period];
                    return `
                        <div class="time-period-card">
                            <div class="period-header">
                                <span class="period-emoji">${data.emoji}</span>
                                <h3 class="period-title">${data.label}</h3>
                            </div>
                            <div class="period-stats">
                                <div class="period-accuracy">${data.accuracy}%</div>
                                <div class="period-tasks">${data.correct}/${data.total} zada≈Ñ</div>
                            </div>
                            <div class="period-rating ${this.getAccuracyRating(data.accuracy)}">
                                ${this.getAccuracyDescription(data.accuracy)}
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `<div class="time-period-grid">${periodsHTML}</div>`;
            }
            
            renderTimeRecommendations() {
                const container = document.getElementById('time-recommendations');
                if (!container || !this.analyticsData.timeOfDayAnalysis) return;
                
                const timePeriods = this.analyticsData.timeOfDayAnalysis.timePeriods || {};
                const bestPeriod = this.getBestTimePeriod(timePeriods);
                const worstPeriod = this.getWorstTimePeriod(timePeriods);
                
                const recommendations = [];
                
                if (bestPeriod) {
                    recommendations.push({
                        emoji: '‚≠ê',
                        type: 'success',
                        title: 'Najlepsza pora dnia',
                        message: `Najwy≈ºszƒÖ skuteczno≈õƒá ${bestPeriod.accuracy}% osiƒÖgasz ${bestPeriod.label.toLowerCase()}. Planuj trudniejsze zadania na tƒô porƒô.`
                    });
                }
                
                if (worstPeriod && worstPeriod.accuracy < 70) {
                    recommendations.push({
                        emoji: 'üîÑ',
                        type: 'warning',
                        title: 'Mo≈ºesz poprawiƒá',
                        message: `${worstPeriod.label} twoja skuteczno≈õƒá wynosi ${worstPeriod.accuracy}%. Rozwa≈º kr√≥tsze sesje lub ≈Çatwiejsze zadania w tej porze.`
                    });
                }
                
                if (recommendations.length === 0) {
                    recommendations.push({
                        emoji: 'üìä',
                        type: 'info',
                        title: 'Kontynuuj naukƒô',
                        message: 'Zbierz wiƒôcej danych, aby otrzymaƒá spersonalizowane rekomendacje dotyczƒÖce por y dnia.'
                    });
                }
                
                this.renderInsights(recommendations, 'time-recommendations');
            }
            
            renderSubjectMetrics() {
                const container = document.getElementById('subjects-metrics');
                if (!container || !this.analyticsData.subjectAnalysis) return;
                
                const subjects = this.analyticsData.subjectAnalysis.subjects || {};
                const subjectNames = Object.keys(subjects).filter(name => subjects[name].performance.total >= 3);
                
                if (subjectNames.length === 0) {
                    container.innerHTML = '<div class="placeholder-text">Dodaj wiƒôcej zada≈Ñ z r√≥≈ºnych przedmiot√≥w</div>';
                    return;
                }
                
                const subjectsHTML = subjectNames.map(name => {
                    const subject = subjects[name];
                    const perf = subject.performance;
                    return `
                        <div class="enhanced-metric-card" style="--metric-color: ${this.getSubjectColor(name)};">
                            <div class="metric-card-header">
                                <div class="metric-card-icon">${subject.icon || 'üìö'}</div>
                                <span class="metric-card-title">${name}</span>
                            </div>
                            <div class="metric-card-value">${perf.accuracy}%</div>
                            <div class="metric-card-subtitle">${perf.correct}/${perf.total} poprawnych</div>
                            <div class="metric-card-trend ${this.getTrendClass(perf.trend)}">
                                ${this.getTrendIcon(perf.trend)} ${this.getTrendText(perf.trend)}
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = subjectsHTML;
            }
            
            renderLocationCards() {
                const container = document.getElementById('location-cards');
                if (!container || !this.analyticsData.locationAnalysis) return;
                
                const locations = this.analyticsData.locationAnalysis.locations || {};
                const locationNames = Object.keys(locations).filter(name => locations[name].total >= 3);
                
                if (locationNames.length === 0) {
                    container.innerHTML = '<div class="placeholder-text">Dodaj wiƒôcej zada≈Ñ z r√≥≈ºnych lokalizacji</div>';
                    return;
                }
                
                const locationsHTML = locationNames.map(name => {
                    const location = locations[name];
                    return `
                        <div class="location-card">
                            <div class="location-header">
                                <span class="location-icon">üìç</span>
                                <h3 class="location-name">${name}</h3>
                            </div>
                            <div class="location-stats">
                                <div class="location-accuracy">${location.accuracy}%</div>
                                <div class="location-tasks">${location.correct}/${location.total} zada≈Ñ</div>
                                <div class="location-subjects">${Object.keys(location.subjects).length} przedmiot√≥w</div>
                            </div>
                            <div class="location-rating ${this.getAccuracyRating(location.accuracy)}">
                                ${this.getLocationRating(location.accuracy)}
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = `<div class="location-comparison">${locationsHTML}</div>`;
            }
            
            renderProgressIndicators() {
                const container = document.getElementById('progress-indicators');
                if (!container || !this.analyticsData.progressTracking) return;
                
                const progress = this.analyticsData.progressTracking;
                const milestones = progress.milestones || [];
                const streaks = progress.streaks || {};
                
                const progressHTML = `
                    <div class="progress-metrics-grid">
                        <div class="progress-metric-card">
                            <div class="progress-icon">üèÜ</div>
                            <div class="progress-value">${streaks.current || 0}</div>
                            <div class="progress-label">Aktualna passa</div>
                        </div>
                        <div class="progress-metric-card">
                            <div class="progress-icon">üî•</div>
                            <div class="progress-value">${streaks.longest || 0}</div>
                            <div class="progress-label">Najd≈Çu≈ºsza passa</div>
                        </div>
                        <div class="progress-metric-card">
                            <div class="progress-icon">üìä</div>
                            <div class="progress-value">${progress.totalWeeks || 0}</div>
                            <div class="progress-label">Tygodni nauki</div>
                        </div>
                        <div class="progress-metric-card">
                            <div class="progress-icon">üéÜ</div>
                            <div class="progress-value">${milestones.length}</div>
                            <div class="progress-label">OsiƒÖgniƒôcia</div>
                        </div>
                    </div>
                `;
                
                container.innerHTML = progressHTML;
            }
            
            renderAchievements() {
                const container = document.getElementById('achievements-section');
                if (!container || !this.analyticsData.progressTracking) return;
                
                const milestones = this.analyticsData.progressTracking.milestones || [];
                const achievements = this.generateAchievements();
                
                if (achievements.length === 0) {
                    container.innerHTML = '<div class="placeholder-text">Kontynuuj naukƒô, aby odblokowaƒá pierwsze osiƒÖgniƒôcie!</div>';
                    return;
                }
                
                this.renderInsights(achievements, 'achievements-section');
            }
            
            showLoading(show) {
                const loadingEl = document.getElementById('enhanced-analytics-loading');
                if (loadingEl) {
                    loadingEl.style.display = show ? 'block' : 'none';
                }
            }
            
            showError(message) {
                const errorEl = document.getElementById('enhanced-analytics-error');
                if (errorEl) {
                    errorEl.style.display = 'block';
                    const messageEl = errorEl.querySelector('.error-message');
                    if (messageEl) {
                        messageEl.textContent = message;
                    }
                }
            }
            
            handleChartControl(button) {
                // Handle chart control button clicks
                const period = button.getAttribute('data-period');
                console.log('Chart control clicked:', period);
                
                // Update active button
                button.parentElement.querySelectorAll('.chart-control-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                
                // Update chart based on period (placeholder for now)
                console.log('Chart would be updated for period:', period);
            }
            
            // Helper methods for data visualization
            getAccuracyRating(accuracy) {
                if (accuracy >= 90) return 'excellent';
                if (accuracy >= 80) return 'good';
                if (accuracy >= 70) return 'average';
                if (accuracy >= 60) return 'below-average';
                return 'poor';
            }
            
            getAccuracyDescription(accuracy) {
                if (accuracy >= 90) return 'Wy≈õmienicie!';
                if (accuracy >= 80) return 'Bardzo dobrze';
                if (accuracy >= 70) return 'Dobrze';
                if (accuracy >= 60) return 'Mo≈ºe byƒá lepiej';
                return 'Potrzeba poprawy';
            }
            
            getLocationRating(accuracy) {
                if (accuracy >= 90) return 'Idealne miejsce';
                if (accuracy >= 80) return 'Bardzo dobre miejsce';
                if (accuracy >= 70) return 'Dobre miejsce';
                if (accuracy >= 60) return 'Przeciƒôtne miejsce';
                return 'Rozwa≈º zmianƒô miejsca';
            }
            
            getBestTimePeriod(timePeriods) {
                const periods = Object.keys(timePeriods).filter(p => timePeriods[p].total >= 3);
                if (periods.length === 0) return null;
                const bestPeriodKey = periods.reduce((best, period) => 
                    timePeriods[period].accuracy > timePeriods[best].accuracy ? period : best
                );
                return timePeriods[bestPeriodKey];
            }
            
            getWorstTimePeriod(timePeriods) {
                const periods = Object.keys(timePeriods).filter(p => timePeriods[p].total >= 3);
                if (periods.length === 0) return null;
                const worstPeriodKey = periods.reduce((worst, period) => 
                    timePeriods[period].accuracy < timePeriods[worst].accuracy ? period : worst
                );
                return timePeriods[worstPeriodKey];
            }
            
            getSubjectColor(subjectName) {
                const colors = ['#1e3a8a', '#059669', '#d97706', '#dc2626', '#7c3aed', '#0891b2'];
                const hash = subjectName.split('').reduce((a, b) => {
                    a = ((a << 5) - a) + b.charCodeAt(0);
                    return a & a;
                }, 0);
                return colors[Math.abs(hash) % colors.length];
            }
            
            getTrendClass(trend) {
                if (trend > 5) return 'improving';
                if (trend < -5) return 'declining';
                return 'stable';
            }
            
            getTrendIcon(trend) {
                if (trend > 5) return 'üìà';
                if (trend < -5) return 'üìâ';
                return '‚û°Ô∏è';
            }
            
            getTrendText(trend) {
                if (trend > 5) return `Poprawa o ${trend}%`;
                if (trend < -5) return `Spadek o ${Math.abs(trend)}%`;
                return 'Stabilnie';
            }
            
            generateAchievements() {
                const achievements = [];
                const report = this.enhancedAnalytics.generateReport();
                const summary = report.summary;
                
                // Achievement for first tasks
                if (summary.totalTasks >= 1) {
                    achievements.push({
                        emoji: 'üéØ',
                        type: 'success',
                        title: 'Pierwszy krok!',
                        message: 'Wykona≈Çe≈õ pierwsze zadanie. Ka≈ºda podr√≥≈º zaczyna siƒô od jednego kroku.'
                    });
                }
                
                // Achievement for consistency
                if (summary.currentStreak >= 3) {
                    achievements.push({
                        emoji: 'üî•',
                        type: 'success',
                        title: 'Na dobrej drodze!',
                        message: `Masz ${summary.currentStreak} dni z rzƒôdu! Systematyczno≈õƒá to klucz do sukcesu.`
                    });
                }
                
                // Achievement for accuracy
                if (summary.overallAccuracy >= 80 && summary.totalTasks >= 10) {
                    achievements.push({
                        emoji: 'üèÜ',
                        type: 'success',
                        title: 'Mistrz precyzji!',
                        message: `Twoja skuteczno≈õƒá ${summary.overallAccuracy}% to doskona≈Çy wynik!`
                    });
                }
                
                // Achievement for dedication
                if (summary.totalTasks >= 50) {
                    achievements.push({
                        emoji: 'üåü',
                        type: 'success',
                        title: 'Prawdziwy dedykowany!',
                        message: `Wykona≈Çe≈õ ju≈º ${summary.totalTasks} zada≈Ñ. Twoja determinacja jest imponujƒÖca!`
                    });
                }
                
                return achievements;
            }
        }
        
        // Setup navigation
        setTimeout(setupNavigation, 100);
    </script>
</body>
</html>
