<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System ZarzƒÖdzania Danymi</title>
    <meta name="description" content="Profesjonalny system do zarzƒÖdzania danymi i analizƒÖ wynik√≥w">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/left-navigation.css">
    <link rel="stylesheet" href="css/management-styles.css">
    <link rel="stylesheet" href="css/study-session.css">
    <link rel="stylesheet" href="css/task-analysis-forms.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- Dark theme override must be last among CSS to take precedence -->
    <link rel="stylesheet" href="css/theme-dark.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body class="theme-dark">
    <div class="container">
        <header class="header">
            <div class="header-content">
                <button type="button" id="nav-toggle" class="nav-toggle" aria-label="Toggle Navigation">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
                <h1 class="system-title">System ZarzƒÖdzania Danymi</h1>
                <p class="system-subtitle">Profesjonalne rozwiƒÖzanie do wprowadzania i analizy danych</p>
            </div>
        </header>

        <!-- Left Side Navigation -->
        <nav class="left-navigation" id="left-navigation">
            <div class="nav-overlay" id="nav-overlay"></div>
            <div class="nav-sidebar">
                <div class="nav-header">
                    <h2 class="nav-title">Menu</h2>
                    <button type="button" class="nav-close" id="nav-close" aria-label="Close Navigation">
                        ‚úï
                    </button>
                </div>
                
                <div class="nav-content">
                    <!-- Main Section -->
                    <div class="nav-section">
                        <button type="button" class="nav-item active" data-target="dashboard">
                            <span class="nav-icon">üè†</span>
                            <span class="nav-label">Dashboard</span>
                        </button>
                    </div>
                    
                    <!-- Study Session -->
                    <div class="nav-section">
                        <button type="button" class="nav-item" data-target="study">
                            <span class="nav-icon">üéØ</span>
                            <span class="nav-label">Study Session</span>
                        </button>
                    </div>
                    
                    <!-- Data Analysis Section -->
                    <div class="nav-section">
                        <div class="nav-section-header">
                            <span class="nav-section-title">Data Analysis</span>
                            <span class="nav-section-icon">üìä</span>
                        </div>
                        <!-- Keep layout simple: a small Summary button, then the subjects list below -->
                        <button type="button" class="nav-subitem" data-target="analytics" data-summary="true" title="All subjects summary" style="margin-left:16px;">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-label">Summary</span>
                        </button>
                        <div class="nav-subsection" id="subjects-nav-list">
                            <div class="nav-loading">
                                <span class="loading-text">Loading subjects...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Entry Section -->
                    <div class="nav-section">
                        <div class="nav-section-header">
                            <span class="nav-section-title">Data Entry</span>
                            <span class="nav-section-icon">üìù</span>
                        </div>
                        <div class="nav-subsection">
                            <button type="button" class="nav-subitem" data-target="add-tasks">
                                <span class="nav-icon">üìù</span>
                                <span class="nav-label">Add Tasks</span>
                            </button>
                            <button type="button" class="nav-subitem" data-target="add-subjects">
                                <span class="nav-icon">üìö</span>
                                <span class="nav-label">Add Subjects</span>
                            </button>
                            <button type="button" class="nav-subitem" data-target="add-categories">
                                <span class="nav-icon">üè∑Ô∏è</span>
                                <span class="nav-label">Add Categories</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <!-- Message container for success/error messages -->
            <div id="message-container" class="message-container" style="display: none;"></div>

            <!-- Dashboard Container (Default View) -->
            <section id="dashboard-container" class="dashboard-container" style="display: block; visibility: visible; opacity: 1;">
                <div class="dashboard-header">
                    <div class="dashboard-titles">
                        <h1 class="dashboard-title">üè† Dashboard</h1>
                        <p class="dashboard-subtitle">Szybki przeglƒÖd postƒôp√≥w i skr√≥ty do akcji</p>
                    </div>
                    <div class="dashboard-right">
                        <div class="current-date" id="current-date"></div>
                        <button id="refresh-dashboard" class="btn btn-outline">üîÑ Od≈õwie≈º dane</button>
                    </div>
                </div>

                <!-- Info cards grid -->
                <div class="dashboard-grid">
                    <div class="info-card">
                        <div class="info-card-title">Przedmioty</div>
                        <div class="info-card-value" id="stat-total-subjects">0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">Kategorie</div>
                        <div class="info-card-value" id="stat-total-categories">0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">Zadania</div>
                        <div class="info-card-value" id="stat-total-tasks">0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">Dok≈Çadno≈õƒá</div>
                        <div class="info-card-value" id="stat-accuracy-overall">0%</div>
                    </div>
                </div>

                <!-- Quick actions -->
                <div class="quick-actions">
                    <button type="button" class="quick-action-btn nav-subitem" data-target="add-tasks">üìù Dodaj Zadanie</button>
                    <button type="button" class="quick-action-btn nav-item" data-target="study">üéØ Start Sesji</button>
                    <button type="button" class="quick-action-btn nav-subitem" data-target="analytics" data-summary="true">üìä Podsumowanie</button>
                    <button type="button" class="quick-action-btn nav-subitem" data-target="add-subjects">üìö Przedmioty</button>
                    <button type="button" class="quick-action-btn nav-subitem" data-target="add-categories">üè∑Ô∏è Kategorie</button>
                </div>

                <!-- Subject tabs + categories content -->
                <div class="dashboard-panels">
                    <div id="subject-tabs" class="subject-tabs"></div>
                    <div id="categories-content" class="categories-content"></div>
                </div>

                <!-- Subject Progress (all subjects) -->
                <section id="subject-progress-section" class="subject-progress-section">
                    <h2 class="section-h2">üìà Postƒôp wed≈Çug przedmiot√≥w</h2>
                    <p class="section-sub">Ostatnie 30 dni ‚Äî ka≈ºda linia to jeden przedmiot</p>
                    <div class="chart-controls">
                        <div class="pill-group" id="subject-filter-pills"></div>
                        <div class="pill-group" id="timeframe-pills">
                            <button type="button" data-range="7"  class="pill">7d</button>
                            <button type="button" data-range="30" class="pill active">30d</button>
                            <button type="button" data-range="90" class="pill">90d</button>
                            <button type="button" data-range="all" class="pill">Wszystko</button>
                        </div>
                    </div>
                    <div class="chart-wrapper" style="min-height: 360px;">
                        <canvas id="subject-progress-chart"></canvas>
                    </div>
                    <div class="chart-actions" style="display:flex; gap:8px; margin-top:8px;">
                        <button type="button" id="export-csv" class="btn btn-secondary">‚¨áÔ∏è Export CSV</button>
                        <button type="button" id="export-json" class="btn btn-secondary">‚¨áÔ∏è Export JSON</button>
                        <button type="button" id="copy-link-progress" class="btn btn-outline">üîó Kopiuj link</button>
                    </div>
                </section>

                <!-- Time Analysis (KPIs) -->
                <section id="time-analysis-section" class="time-analysis-overview">
                    <h2 class="section-h2">‚è±Ô∏è Analiza czasu</h2>
                    <div class="kpi-grid-3" id="time-analysis-kpis"></div>
                    <div class="subject-mini-cards" id="subject-mini-cards"></div>
                </section>

                <!-- Multiple Countdowns -->
                <section id="countdowns-section" class="countdowns-section">
                    <h2 class="section-h2">‚è≥ Odliczanie do egzamin√≥w</h2>
                    <div id="countdowns-grid" class="countdowns-grid"></div>
                </section>

                <!-- Daily Activity -->
                <section id="daily-activity-section" class="daily-activity-section">
                    <h2 class="section-h2">üóìÔ∏è Aktywno≈õƒá dzienna wg przedmiot√≥w</h2>
                    <div id="daily-subject-list" class="daily-subject-list"></div>
                </section>

                <!-- Weekly Goal -->
                <section id="weekly-goal-section" class="weekly-goal-section">
                    <h2 class="section-h2">üéØ Cel tygodniowy</h2>
                    <div class="goal-wrap">
                        <div class="goal-ring" id="goal-ring"><span class="goal-val" id="goal-val">0%</span></div>
                        <div class="goal-meta">
                            <div class="goal-title">Zadania w tym tygodniu</div>
                            <div class="goal-desc"><span id="goal-progress">0</span>/<span id="goal-target">0</span> zada≈Ñ</div>
                            <div class="goal-status" id="goal-status">‚Äî</div>
                        </div>
                    </div>
                </section>
            </section>

            <!-- Unified Form Container with Tabs -->
            <div class="unified-form-container" id="main-form-container" style="display: block;">
                <!-- Form Tabs -->
                <div class="form-tabs">
                    <button type="button" class="form-tab active" data-tab="tasks">
                        <span class="tab-icon">üìù</span>
                        Dodawanie Zada≈Ñ
                    </button>
                    <button type="button" class="form-tab" data-tab="subjects">
                        <span class="tab-icon">üìö</span>
                        ZarzƒÖdzanie Przedmiotami
                    </button>
                    <button type="button" class="form-tab" data-tab="categories">
                        <span class="tab-icon">üè∑Ô∏è</span>
                        ZarzƒÖdzanie Kategoriami
                    </button>
                </div>

                <!-- Task Form Tab -->
                <div class="tab-content active" id="tasks-tab">
                    <div class="form-container">
                        <h2>Wprowadzanie Danych</h2>
                        <form id="google-sheets-form" class="google-sheets-form" novalidate>
                        <!-- Task Name field -->
                        <div class="form-group">
                            <label for="task_name" class="form-label">
                                Nazwa zadania <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="task_name" 
                                name="task_name" 
                                class="form-control"
                                maxlength="100"
                                required
                                placeholder="Wprowad≈∫ nazwƒô zadania..."
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Maksymalnie 100 znak√≥w</div>
                        </div>

                        <!-- Description field -->
                        <div class="form-group">
                            <label for="description" class="form-label">
                                Opis <span class="required">*</span>
                            </label>
                            <textarea 
                                id="description" 
                                name="description" 
                                class="form-control form-textarea"
                                maxlength="1000"
                                rows="6"
                                required
                                placeholder="Wprowad≈∫ opis zadania..."
                            ></textarea>
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Maksymalnie 1000 znak√≥w</div>
                        </div>

                        <!-- Categories field (text input for multiple categories) -->
                        <div class="form-group">
                            <label for="categories" class="form-label">
                                Kategorie <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="categories" 
                                name="categories" 
                                class="form-control"
                                maxlength="200"
                                required
                                placeholder="np. Czƒô≈õci mowy, Sk≈Çadnia lub Essays, World War"
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Wprowad≈∫ kategorie oddzielone przecinkami. Przyk≈Çady: "Algebra, R√≥wnania", "Czƒô≈õci mowy, Sk≈Çadnia" (maksymalnie 200 znak√≥w)</div>
                        </div>

                        <!-- Correctly Completed field -->
                        <div class="form-group">
                            <label for="correctly_completed" class="form-label">
                                Wykonano poprawnie <span class="required">*</span>
                            </label>
                            <select 
                                id="correctly_completed" 
                                name="correctly_completed" 
                                class="form-control form-select"
                                required
                            >
                                <option value="">Wybierz opcjƒô...</option>
                                <option value="Yes">Tak</option>
                                <option value="No">Nie</option>
                            </select>
                            <div class="field-error" role="alert"></div>
                        </div>

                        <!-- Location field -->
                        <div class="form-group">
                            <label for="location" class="form-label">
                                Miejsce
                            </label>
                            <input 
                                type="text" 
                                id="location" 
                                name="location" 
                                class="form-control"
                                maxlength="100"
                                placeholder="np. Dom, Biblioteka, Szko≈Ça..."
                                autocomplete="off"
                            >
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Opcjonalne - miejsce wykonania zadania (maksymalnie 100 znak√≥w)</div>
                        </div>

                        <!-- Subject field -->
                        <div class="form-group">
                            <label for="subject" class="form-label">
                                Przedmiot <span class="required">*</span>
                            </label>
                            <select
                                id="subject"
                                name="subject"
                                class="form-control form-select"
                                required
                            >
                                <option value="">Pobieranie przedmiot√≥w z Google Sheets...</option>
                            </select>
                            <div class="field-error" role="alert"></div>
                            <div class="field-help">Wybierz przedmiot z listy</div>
                        </div>

                        <!-- Submit button -->
                        <div class="form-actions">
                            <button type="submit" id="submit-button" class="btn btn-primary">
                                Wy≈õlij
                            </button>
                            <button type="button" id="reset-button" class="btn btn-secondary" onclick="document.getElementById('google-sheets-form').reset();">
                                Wyczy≈õƒá
                            </button>
                        </div>
                    </form>
                    </div>
                </div>

                <!-- Subjects Management Tab -->
                <div class="tab-content" id="subjects-tab">
                    <div class="management-section">
                        <div class="management-header">
                            <h2 class="management-title">üìö ZarzƒÖdzanie Przedmiotami</h2>
                            <p class="management-subtitle">Dodawaj, edytuj i usuwaj przedmioty</p>
                        </div>

                        <!-- Add Subject Form -->
                        <div class="management-form-section">
                            <div class="form-card">
                                <h3 class="form-card-title">‚ûï Dodaj Nowy Przedmiot</h3>
                                <form id="add-subject-form" class="management-form">
                                    <div class="form-group">
                                        <label for="subject-name" class="form-label">
                                            Nazwa Przedmiotu <span class="required">*</span>
                                        </label>
                                        <input 
                                            type="text" 
                                            id="subject-name" 
                                            name="subject_name" 
                                            class="form-control"
                                            maxlength="100"
                                            required
                                            placeholder="np. Matematyka, Historia..."
                                        >
                                        <div class="field-error" role="alert"></div>
                                    </div>

                                    <div class="form-group">
                                        <label for="subject-color" class="form-label">
                                            Kolor
                                        </label>
                                        <input 
                                            type="color" 
                                            id="subject-color" 
                                            name="color" 
                                            class="form-control form-color"
                                            value="#667eea"
                                        >
                                        <div class="field-help">Wybierz kolor dla przedmiotu</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="subject-icon" class="form-label">
                                            Ikona
                                        </label>
                                        <input 
                                            type="text" 
                                            id="subject-icon" 
                                            name="icon" 
                                            class="form-control"
                                            maxlength="10"
                                            value="üìö"
                                            placeholder="np. üìö, üî¨, üìê"
                                        >
                                        <div class="field-help">Ikona emoji dla przedmiotu</div>
                                    </div>

                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="btn-icon">üíæ</span>
                                            Dodaj Przedmiot
                                        </button>
                                        <button type="reset" class="btn btn-secondary">
                                            <span class="btn-icon">üîÑ</span>
                                            Wyczy≈õƒá
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Existing Subjects List -->
                        <div class="management-list-section">
                            <div class="list-header">
                                <h3 class="list-title">üìã IstniejƒÖce Przedmioty</h3>
                                <button id="refresh-subjects" class="btn btn-outline">
                                    <span class="btn-icon">üîÑ</span>
                                    Od≈õwie≈º
                                </button>
                            </div>
                            <div class="subjects-list" id="subjects-list">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <span>≈Åadowanie przedmiot√≥w...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Categories Management Tab -->
                <div class="tab-content" id="categories-tab">
                    <div class="management-section">
                        <div class="management-header">
                            <h2 class="management-title">üè∑Ô∏è ZarzƒÖdzanie Kategoriami</h2>
                            <p class="management-subtitle">Dodawaj, edytuj i usuwaj kategorie zada≈Ñ</p>
                        </div>

                        <!-- Add Category Form -->
                        <div class="management-form-section">
                            <div class="form-card">
                                <h3 class="form-card-title">‚ûï Dodaj NowƒÖ Kategoriƒô</h3>
                                <form id="add-category-form" class="management-form">
                                    <div class="form-group">
                                        <label for="category-name" class="form-label">
                                            Nazwa Kategorii <span class="required">*</span>
                                        </label>
                                        <input 
                                            type="text" 
                                            id="category-name" 
                                            name="category_name" 
                                            class="form-control"
                                            maxlength="100"
                                            required
                                            placeholder="np. Algebra, Gramatyka..."
                                        >
                                        <div class="field-error" role="alert"></div>
                                    </div>

                                    <div class="form-group">
                                        <label for="category-subject" class="form-label">
                                            Przedmiot <span class="required">*</span>
                                        </label>
                                        <select 
                                            id="category-subject" 
                                            name="subject_name" 
                                            class="form-control form-select"
                                            required
                                        >
                                            <option value="">Pobieranie przedmiot√≥w...</option>
                                        </select>
                                        <div class="field-error" role="alert"></div>
                                        <div class="field-help">Wybierz przedmiot dla tej kategorii</div>
                                    </div>

                                    <div class="form-group">
                                        <label for="category-difficulty" class="form-label">
                                            Poziom trudno≈õci <span class="required">*</span>
                                        </label>
                                        <select 
                                            id="category-difficulty" 
                                            name="difficulty" 
                                            class="form-control form-select"
                                            required
                                        >
                                            <option value="">Wybierz poziom...</option>
                                            <option value="≈Åatwy">≈Åatwy</option>
                                            <option value="≈öredni">≈öredni</option>
                                            <option value="Trudny">Trudny</option>
                                        </select>
                                        <div class="field-error" role="alert"></div>
                                        <div class="field-help">Okre≈õl poziom trudno≈õci kategorii</div>
                                    </div>

                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="btn-icon">üíæ</span>
                                            Dodaj Kategoriƒô
                                        </button>
                                        <button type="reset" class="btn btn-secondary">
                                            <span class="btn-icon">üîÑ</span>
                                            Wyczy≈õƒá
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Existing Categories List -->
                        <div class="management-list-section">
                            <div class="list-header">
                                <h3 class="list-title">üìã IstniejƒÖce Kategorie</h3>
                                <button id="refresh-categories" class="btn btn-outline">
                                    <span class="btn-icon">üîÑ</span>
                                    Od≈õwie≈º
                                </button>
                            </div>
                            <div class="categories-list" id="categories-list">
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <span>≈Åadowanie kategorii...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Container -->
            <div class="analytics-dashboard" id="analytics-container" style="display: none;">
                <!-- Analytics Header -->
                <!-- <div class="analytics-header">
                    <div class="analytics-title-section">
                        <h1 class="analytics-main-title">üìä Analityka Wynik√≥w</h1>
                        <p class="analytics-subtitle">Wybierz przedmiot aby zobaczyƒá szczeg√≥≈Çowe statystyki i postƒôpy</p>
                    </div>
                </div> -->
                
                <!-- Main Analytics Layout -->
                <div class="analytics-main-layout">
                    <!-- Left Panel: Large Subject Selection -->
                    <div class="analytics-left-panel">
                        <div class="subject-selection-panel" id="subject-selection-section" style="display: none;">
                            <h2 class="panel-title">üéØ Twoje Przedmioty</h2>
                            <div class="large-subject-buttons" id="subject-buttons" style="display: grid; grid-template-columns: auto auto;">
                                <!-- Large enhanced subject buttons will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- No Data State -->
                        <div class="no-subjects-panel" id="no-subjects-panel" style="display: none;">
                            <div class="no-data-illustration">üìà</div>
                            <h3 class="no-data-title">Brak Danych do Analizy</h3>
                            <p class="no-data-description">Dodaj zadania do Google Sheets, aby zobaczyƒá analitykƒô wynik√≥w wed≈Çug przedmiot√≥w.</p>
                        </div>
                    </div>
                    
                    <!-- Right Panel: Detailed Analytics -->
                    <div class="analytics-right-panel">
                        <div class="form-tabs analytics-tabs" id="analytics-top-tabs">
                            <button type="button" class="form-tab" id="summary-tab-btn" data-tab="summary">
                                <span class="tab-icon">üìä</span>
                                Podsumowanie
                            </button>
                        </div>
                        <div class="analytics-content" id="analytics-content">
                            <div class="welcome-state" id="welcome-state">
                                <div class="welcome-illustration">üëà</div>
                                <h3 class="welcome-title">Wybierz Przedmiot</h3>
                                <p class="welcome-description">Kliknij na przedmiot po lewej stronie, aby zobaczyƒá szczeg√≥≈ÇowƒÖ analizƒô wynik√≥w, kategorii i postƒôp√≥w w nauce.</p>
                                <div class="welcome-features">
                                    <div class="feature-item">
                                        <span class="feature-icon">üìä</span>
                                        <span class="feature-text">Szczeg√≥≈Çowe statystyki</span>
                                    </div>
                                    <div class="feature-item">
                                        <span class="feature-icon">üìà</span>
                                        <span class="feature-text">Analizy postƒôp√≥w</span>
                                    </div>
                                    <div class="feature-item">
                                        <span class="feature-icon">üéØ</span>
                                        <span class="feature-text">S≈Çabe punkty do poprawy</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="loading-state" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">Analizowanie wynik√≥w...</div>
                            </div>
                        </div>
                    </div>
            </div>
        </div>


            <!-- Study Session Modal -->
            <div class="modal-overlay" id="study-session-modal" style="display: none;">
                <div class="modal-content study-session-content">
                    <div class="modal-header">
                        <div class="header-left">
                            <button type="button" id="exit-session-btn" class="exit-btn" title="Exit Session">
                                <span class="btn-icon">‚úï</span>
                            </button>
                        </div>
                        <div class="header-center">
                            <h3 class="modal-title">üéØ Sesja Nauki w Toku</h3>
                        </div>
                        <div class="header-right">
                            <div class="view-mode-switcher">
                                <label class="switch-label">Widok:</label>
                                <div class="mode-switch">
                                    <input type="checkbox" id="mobile-mode-toggle" class="mode-toggle">
                                    <span class="mode-slider">
                                        <span class="mode-icon desktop-icon">üíª</span>
                                        <span class="mode-icon mobile-icon">üì±</span>
                                    </span>
                                </div>
                                <span class="mode-label" id="current-mode-label">Desktop</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body">
                        <!-- Clean Mobile Layout -->
                        <div class="mobile-grid">
                            <!-- Stats Bar -->
                            <div class="mobile-stats task-counters">
                                <div class="stat-item counter-item">
                                    <div class="stat-value counter-value" id="total-tasks-counter">0</div>
                                    <div class="stat-label counter-label">Total</div>
                                </div>
                                <div class="stat-item counter-item correct">
                                    <div class="stat-value counter-value" id="correct-tasks-counter">0</div>
                                    <div class="stat-label counter-label">Correct</div>
                                </div>
                                <div class="stat-item counter-item incorrect">
                                    <div class="stat-value counter-value" id="incorrect-tasks-counter">0</div>
                                    <div class="stat-label counter-label">Wrong</div>
                                </div>
                            </div>

                            <!-- Main Action Buttons -->
                            <div class="mobile-actions task-actions" id="task-action-buttons">
                                <button type="button" id="correct-task-btn" class="action-btn correct">
                                    <span class="btn-icon">‚úì</span>
                                    <span class="action-label">Correct</span>
                                </button>
                                <button type="button" id="incorrect-task-btn" class="action-btn incorrect">
                                    <span class="btn-icon">√ó</span>
                                    <span class="action-label">Wrong</span>
                                </button>
                            </div>

                            <!-- Form Section -->
                            <div class="mobile-form task-edit-section" id="task-edit-section">
                                <h3 class="form-title task-edit-title">Task Details</h3>
                                <form id="task-edit-form">
                                    <div class="form-field form-group">
                                        <label class="field-label form-label">Task Name <span class="required">*</span></label>
                                        <input type="text" name="task_name" class="field-input form-control" 
                                               placeholder="Enter task name..." required>
                                    </div>
                                    <div class="form-field form-group">
                                        <label class="field-label form-label">Categories <span class="required">*</span></label>
                                        <!-- Custom Mobile Category Selector -->
                                        <div class="category-selector" id="mobile-category-selector">
                                            <!-- Categories will be populated here -->
                                        </div>
                                        <div class="selected-count field-help" id="category-count">Select categories</div>
                                        <!-- Hidden original select for form submission -->
                                        <select name="category" class="form-control" multiple required style="display: none;" id="category-select-hidden">
                                            <!-- Categories will be populated here -->
                                        </select>
                                    </div>
                                    <div class="form-field form-group">
                                        <label class="field-label form-label">Description</label>
                                        <textarea name="description" class="field-input field-textarea form-control" 
                                                  placeholder="Optional description..." rows="2"></textarea>
                                    </div>
                                    <!-- Hidden in mobile mode -->
                                    <div class="task-edit-actions" style="display: none;" id="task-save-actions">
                                        <button type="button" id="save-task-btn" class="btn btn-primary">
                                            <span class="btn-icon">üíæ</span>
                                            Zapisz i przygotuj nastƒôpne
                                        </button>
                                        <button type="button" id="clear-form-btn" class="btn btn-secondary">
                                            <span class="btn-icon">üîÑ</span>
                                            Wyczy≈õƒá formularz
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Bottom Info Bar -->
                            <div class="mobile-info mobile-bottom">
                                <div class="info-item current-task-info">
                                    <div class="task-info-item">
                                        <div class="info-value task-info-value" id="current-task-number">1</div>
                                        <div class="info-label task-info-label">Task</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-value task-info-value" id="current-task-time">00:00</div>
                                    <div class="info-label task-info-label">Time</div>
                                </div>
                                <div class="info-controls session-controls">
                                    <button type="button" id="pause-session-btn" class="control-btn btn btn-secondary" title="Pause Session">
                                        <span class="btn-icon" id="pause-btn-icon">‚è∏Ô∏è</span>
                                    </button>
                                    <button type="button" id="finish-session-btn" class="control-btn primary btn btn-primary" title="Finish Session">
                                        <span class="btn-icon">üèÅ</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Celebration Overlay -->
                    <div class="celebration-overlay" id="celebration-overlay" style="display: none;">
                        <div class="celebration-content">
                            <div class="celebration-icon" id="celebration-icon">üéâ</div>
                            <div class="celebration-text" id="celebration-text">Dobra robota!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Session Results Modal -->
            <div class="modal-overlay" id="study-results-modal" style="display: none;">
                <div class="modal-content study-results-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üèÜ Sesja Nauki Zako≈Ñczona</h3>
                        <button type="button" class="modal-close" id="close-results-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- Final Session Timer -->
                        <div class="final-timer-display">
                            <div class="final-timer-icon">‚è±Ô∏è</div>
                            <div class="final-timer-value" id="final-session-time">00:00</div>
                            <div class="final-timer-label">Ca≈Çkowity czas nauki</div>
                        </div>

                        <!-- Session Summary -->
                        <div class="session-summary-grid">
                            <div class="summary-item">
                                <div class="summary-value" id="final-total-tasks">0</div>
                                <div class="summary-label">Zadania razem</div>
                            </div>
                            <div class="summary-item correct">
                                <div class="summary-value" id="final-correct-tasks">0</div>
                                <div class="summary-label">Poprawne</div>
                            </div>
                            <div class="summary-item incorrect">
                                <div class="summary-value" id="final-incorrect-tasks">0</div>
                                <div class="summary-label">B≈Çƒôdne</div>
                            </div>
                            <div class="summary-item accuracy">
                                <div class="summary-value" id="final-accuracy">0%</div>
                                <div class="summary-label">Dok≈Çadno≈õƒá</div>
                            </div>
                        </div>

                        <!-- Small Adjustments Section -->
                        <div class="small-adjustments">
                            <h4 class="adjustments-title">üîß Ma≈Çe korekty</h4>
                            <p class="adjustments-description">Mo≈ºesz wprowadziƒá drobne zmiany do sesji:</p>
                            <div class="adjustments-form">
                                <div class="form-group">
                                    <label class="form-label">Dodatkowe notatki</label>
                                    <textarea id="session-notes-adjustment" class="form-control" rows="3" 
                                              placeholder="Dodaj dodatkowe notatki o sesji..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="results-actions">
                            <button type="button" id="save-session-results" class="btn btn-success btn-large">
                                <span class="btn-icon">üíæ</span>
                                Zapisz sesjƒô
                            </button>
                            <button type="button" id="edit-tasks-detail" class="btn btn-secondary">
                                <span class="btn-icon">‚úèÔ∏è</span>
                                Edytuj szczeg√≥≈Çy zada≈Ñ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Sessions Dashboard Container -->
            <div class="study-sessions-dashboard" id="study-container" style="display: none; visibility: hidden;">
                <!-- Enhanced Study Sessions Content -->
                    <div class="study-demo-card">
                        <h1 class="study-demo-title">üéØ Study Sessions</h1>
                        <p class="study-demo-subtitle">If you can see this, the study view is working!</p>
                        
                        <div class="study-demo-actions">
                            <button id="start-study-button" class="btn btn-success btn-lg study-demo-btn">
                                üèÅ Start Study Session
                            </button>
                            <button id="view-history-button" class="btn btn-secondary btn-lg study-demo-btn">
                                üìÖ View History
                            </button>
                        </div>

                    <!-- Study Dashboard Stats -->
                        <div class="session-stats-panel">
                        <h2 class="panel-title">üìä Statystyki Dzisiaj</h2>
                        <div class="quick-stats-grid">
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-sessions">0</div>
                                <div class="stat-label">Sesje Dzisiaj</div>
                            </div>
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-tasks">0</div>
                                <div class="stat-label">Zadania Dzisiaj</div>
                            </div>
                            <div class="quick-stat-item">
                                <div class="stat-value" id="today-accuracy">0%</div>
                                <div class="stat-label">Dok≈Çadno≈õƒá</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Sessions List -->
                        <div class="recent-sessions-panel">
                        <h2 class="panel-title">üìÖ Ostatnie Sesje</h2>
                        <div id="recent-sessions-list" class="recent-sessions-list">
                            <div class="no-sessions-placeholder">
                                <div class="placeholder-icon">üìà</div>
                                <p>Brak ostatnich sesji nauki</p>
                                <p class="placeholder-description">Rozpocznij pierwszƒÖ sesjƒô, aby zobaczyƒá historiƒô</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Analytics Dashboard Container -->

            <!-- Study Session Modal -->
            <div class="modal-overlay" id="study-analysis-modal" style="display: none;">
                <div class="modal-content study-analysis-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üìà Analiza Sesji Nauki</h3>
                        <div class="session-summary" id="session-summary">
                            Zadania: <span id="summary-total">0</span> | 
                            Poprawne: <span id="summary-correct">0</span> | 
                            B≈Çƒôdne: <span id="summary-incorrect">0</span>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div class="analysis-form-container" id="analysis-form-container">
                            <!-- Task analysis forms will be dynamically inserted here -->
                        </div>
                        <div class="analysis-actions">
                            <button type="button" id="submit-analysis-btn" class="btn btn-primary btn-large">
                                <span class="btn-icon">üíæ</span>
                                Zapisz Wszystkie Dane
                            </button>
                            <button type="button" id="cancel-analysis-btn" class="btn btn-secondary">
                                <span class="btn-icon">‚ùå</span>
                                Anuluj
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Session History Modal -->
            <div class="modal-overlay" id="session-history-modal" style="display: none;">
                <div class="modal-content session-history-content">
                    <div class="modal-header">
                        <h3 class="modal-title">üìÖ Historia Sesji Nauki</h3>
                        <button class="modal-close" id="close-history-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- History Filters -->
                        <div class="history-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label for="history-date-filter" class="filter-label">Okres:</label>
                                    <select id="history-date-filter" class="form-control filter-select">
                                        <option value="all">Wszystkie sesje</option>
                                        <option value="today">Dzisiaj</option>
                                        <option value="week">Ostatni tydzie≈Ñ</option>
                                        <option value="month">Ostatni miesiƒÖc</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="history-sort-filter" class="filter-label">Sortowanie:</label>
                                    <select id="history-sort-filter" class="form-control filter-select">
                                        <option value="newest">Najnowsze pierwsze</option>
                                        <option value="oldest">Najstarsze pierwsze</option>
                                        <option value="duration">Czas trwania</option>
                                        <option value="tasks">Liczba zada≈Ñ</option>
                                        <option value="accuracy">Dok≈Çadno≈õƒá</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-stats" id="history-stats">
                                <span class="stats-item">≈ÅƒÖcznie sesji: <strong id="total-sessions-count">0</strong></span>
                                <span class="stats-item">≈ÅƒÖczny czas: <strong id="total-study-time">0 min</strong></span>
                                <span class="stats-item">≈örednia dok≈Çadno≈õƒá: <strong id="average-accuracy">0%</strong></span>
                            </div>
                        </div>

                        <!-- Session History List -->
                        <div class="session-history-container" id="session-history-container">
                            <div class="loading-state" id="history-loading" style="display: none;">
                                <div class="loading-spinner"></div>
                                <div class="loading-text">≈Åadowanie historii sesji...</div>
                            </div>
                            
                            <div class="no-history-state" id="no-history-state" style="display: none;">
                                <div class="no-data-illustration">üìö</div>
                                <h4>Brak Historii Sesji</h4>
                                <p>Nie masz jeszcze ≈ºadnych zako≈Ñczonych sesji nauki.</p>
                                <p class="help-text">Rozpocznij pierwszƒÖ sesjƒô, aby zobaczyƒá tutaj historiƒô.</p>
                            </div>
                            
                            <div class="sessions-list" id="sessions-history-list">
                                <!-- Session history items will be inserted here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="refresh-history-btn" class="btn btn-outline">
                            <span class="btn-icon">üîÑ</span>
                            Od≈õwie≈º
                        </button>
                        <button type="button" id="close-history-btn" class="btn btn-secondary">
                            <span class="btn-icon">‚ùå</span>
                            Zamknij
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Modal -->
            <div class="modal-overlay" id="edit-modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 class="modal-title" id="edit-modal-title">‚úèÔ∏è Edytuj Element</h3>
                        <button class="modal-close" id="close-edit-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-form">
                            <input type="hidden" id="edit-item-id" name="id">
                            <input type="hidden" id="edit-form-type" name="formType">
                            
                            <!-- Basic name field - will be used for both subjects and categories -->
                            <div class="form-group">
                                <label for="edit-name" class="form-label">
                                    Nazwa <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-name" 
                                    name="name" 
                                    class="form-control"
                                    maxlength="100"
                                    required
                                >
                                <div class="field-error" role="alert"></div>
                            </div>

                            <!-- Subject-specific fields -->
                            <div class="form-group subject-only" id="edit-color-group" style="display: none;">
                                <label for="edit-color" class="form-label">
                                    Kolor
                                </label>
                                <input 
                                    type="color" 
                                    id="edit-color" 
                                    name="color" 
                                    class="form-control form-color"
                                    value="#667eea"
                                >
                                <div class="field-help">Wybierz kolor dla przedmiotu</div>
                            </div>

                            <div class="form-group subject-only" id="edit-icon-group" style="display: none;">
                                <label for="edit-icon" class="form-label">
                                    Ikona
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-icon" 
                                    name="icon" 
                                    class="form-control"
                                    maxlength="10"
                                    placeholder="np. üìö, üî¨, üìê"
                                >
                                <div class="field-help">Ikona emoji dla przedmiotu</div>
                            </div>

                            <!-- Category-specific fields -->
                            <div class="form-group category-only" id="edit-subject-group" style="display: none;">
                                <label for="edit-subject" class="form-label">
                                    Przedmiot <span class="required">*</span>
                                </label>
                                <select 
                                    id="edit-subject" 
                                    name="subject_name" 
                                    class="form-control form-select"
                                    required
                                >
                                    <option value="">≈Åadowanie przedmiot√≥w...</option>
                                </select>
                                <div class="field-error" role="alert"></div>
                            </div>

                            <div class="form-group category-only" id="edit-difficulty-group" style="display: none;">
                                <label for="edit-difficulty" class="form-label">
                                    Poziom trudno≈õci <span class="required">*</span>
                                </label>
                                <select 
                                    id="edit-difficulty" 
                                    name="difficulty" 
                                    class="form-control form-select"
                                    required
                                >
                                    <option value="">Wybierz poziom...</option>
                                    <option value="≈Åatwy">≈Åatwy</option>
                                    <option value="≈öredni">≈öredni</option>
                                    <option value="Trudny">Trudny</option>
                                </select>
                                <div class="field-error" role="alert"></div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <span class="btn-icon">üíæ</span>
                                    Zapisz Zmiany
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancel-edit">
                                    <span class="btn-icon">‚ùå</span>
                                    Anuluj
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </main>

        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2024 System ZarzƒÖdzania Danymi. Wszystkie dane sƒÖ synchronizowane z Google Sheets.</p>
            </div>
        </footer>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p id="loading-text">Przetwarzanie...</p>
    </div>

    <!-- Chart.js for enhanced analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script>
      // Improve Chart.js defaults for dark background
      if (window.Chart) {
        Chart.defaults.color = '#e6e8ee';
        Chart.defaults.borderColor = 'rgba(148,163,184,0.25)';
        Chart.defaults.font = Chart.defaults.font || {};
        Chart.defaults.font.family = 'Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
        Chart.defaults.elements = Chart.defaults.elements || {};
        Chart.defaults.elements.line = Chart.defaults.elements.line || {};
        Chart.defaults.elements.point = Chart.defaults.elements.point || {};
        Chart.defaults.elements.line.borderWidth = 2;
        Chart.defaults.elements.point.radius = 2;
        Chart.defaults.elements.point.hoverRadius = 4;
        Chart.defaults.plugins = Chart.defaults.plugins || {};
        Chart.defaults.plugins.legend = Chart.defaults.plugins.legend || {};
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.legend.labels = Chart.defaults.plugins.legend.labels || {};
        Chart.defaults.plugins.legend.labels.color = '#e6e8ee';
        Chart.defaults.scale = Chart.defaults.scale || {};
        Chart.defaults.scale.grid = Chart.defaults.scale.grid || {};
        Chart.defaults.scale.grid.color = 'rgba(148,163,184,0.15)';
        Chart.defaults.scale.ticks = Chart.defaults.scale.ticks || {};
        Chart.defaults.scale.ticks.color = '#e6e8ee';
        Chart.defaults.animation = Chart.defaults.animation || {};
        Chart.defaults.animation.duration = 250;
      }
    </script>
    
    <!-- JavaScript files -->
    <script src="js/config.js"></script>
    <script src="js/googleSheetsDebugger.js"></script>
    <script src="js/loadingManager.js"></script>
    <script src="js/googleSheetsAPI-v2.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/leftNavigation.js"></script>
    <!-- DISABLED: StudyTrackingManager to prevent duplicate sessions -->
    <!-- <script src="js/studyTrackingManager.js"></script> -->
    <script src="js/analyticsManager.js"></script>
    <script src="js/subjectTimeAnalysis.js"></script>
    <script src="js/chartsManager.js"></script>
    <script src="js/managementForms.js"></script>
    <script src="js/app-simplified.js"></script>
    <script src="js/multiCountdown.js"></script>
    <script src="js/dashboardEnhancements.js"></script>
    
    <!-- App initialization -->
    <script>
        // Global coordination object (StudyTrackingManager disabled - using SimplifiedFormApp only)
        window.systemCoordination = {
            studySessionActive: false,
            isSubmittingStudyData: false
        };
        
        function setCurrentDate() {
            const el = document.getElementById('current-date');
            if (!el) return;
            const today = new Date();
            el.textContent = today.toLocaleDateString('pl-PL', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        
        function updateDashboardStats() {
            try {
                const dm = window.dashboardManager;
                if (!dm) return;
                const totalSubjects = dm.subjects?.length || 0;
                const totalCategories = dm.categories?.length || 0;
                const totalTasks = dm.entries?.length || 0;
                let accuracy = 0;
                if (totalTasks > 0) {
                    let correct = 0;
                    dm.entries.forEach(entry => {
                        let isCorrect = false;
                        if (typeof entry.correctness === 'boolean') {
                            isCorrect = entry.correctness;
                        } else if (typeof entry.correctness === 'string') {
                            const cv = entry.correctness.toLowerCase();
                            isCorrect = (cv === 'poprawnie' || cv === 'dobrze' || cv === 'true');
                        } else if (typeof entry.poprawnosc === 'string') {
                            const cv2 = entry.poprawnosc.toLowerCase();
                            isCorrect = (cv2 === 'poprawnie' || cv2 === 'dobrze');
                        }
                        if (isCorrect) correct += 1;
                    });
                    accuracy = Math.round((correct / totalTasks) * 100);
                }
                const setText = (id, val) => { const n = document.getElementById(id); if (n) n.textContent = val; };
                setText('stat-total-subjects', totalSubjects);
                setText('stat-total-categories', totalCategories);
                setText('stat-total-tasks', totalTasks);
                setText('stat-accuracy-overall', `${accuracy}%`);
            } catch (_) {}
        }
        
        // Initialize default view and dashboard manager
        document.addEventListener('DOMContentLoaded', () => {
            // Show dashboard by default
            const dash = document.getElementById('dashboard-container');
            if (dash) {
                dash.style.display = 'block';
                dash.style.visibility = 'visible';
                dash.style.opacity = '1';
            }
            // Hide other containers initially
            ['main-form-container','study-container','analytics-container'].forEach(id => {
                const el = document.getElementById(id);
                if (el) { el.style.display = 'none'; el.style.visibility = 'hidden'; el.style.opacity = '0'; }
            });
            
            // Initialize dashboard manager
            try {
                const api = new GoogleSheetsAPIv2(CONFIG);
                window.dashboardManager = new DashboardManager(CONFIG, api);
                if (window.dashboardManager && typeof window.dashboardManager.loadDashboardData === 'function') {
                    window.dashboardManager.loadDashboardData().then(() => {
                        updateDashboardStats();
                    });
                }
            } catch (e) {
                console.warn('Dashboard init failed:', e);
            }
            
            setCurrentDate();
        });
        
    </script>
</body>
</html>
